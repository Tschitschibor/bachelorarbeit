% mainfile: ../main.tex

\section{Relations of the Algebroid}

\subsection{Relations of endomorphisms}

% A forest on a cycle
\begin{tikzpicture}[x=0.5cm,y=0.5cm]
\tikzstyle{cblack}=[circle, fill=black, scale=0.5]

%Nodes
\foreach \place/\x in {{(0,0)/0}, {(-4.5,0)/1}, {(-7,-3)/2}, {(-4.5,-6)/3},
  {(0,-6)/4}, {(2.5,-3)/5},
  {(-4.5,3)/6}, {(-7.5,6)/7}, {(-4.5,6)/8},
  {(0,3)/9}, {(0,6)/10}, {(0,9)/11},
  {(3,3)/12}, {(3,6)/13}, {(3,9)/14},
  {(7.5,6)/15}, {(7.5,9)/16}, {(7.5,12)/17}, {(10.5,9)/18}}
\node[cblack] (a\x) at \place {};

%Arrows
\foreach \i in {0,1,2,3,4,5}
{
  \pgfmathtruncatemacro\result{Mod(\i+1,6)}%
  \draw[->] (a\i) -> (a\result);
}
\path[->] (a7) edge (a6); 
\path[->] (a8) edge (a6) edge (a1);
\path[->] (a11) edge (a10) edge (a9) edge (a0);
\path[->] (a14) edge (a13) edge (a12); 
\path[->] (a12) edge (a0);
\path[->] (a18) edge (a15) (a15) edge (a12);
\path[->] (a17) edge (a16) edge (a15);
%\path[->] (a\x) edge (a\y);

\end{tikzpicture}
%\cite{facchini_2019}
\begin{lemma}[$\sigma$-Lemma]
Let $\mathcal{C}$ be a finite concrete category. Then for each object $M \in \mathcal{C}_{0}$ the set
$\textup{End}_{\mathcal{C}}(M)$ is a monoid and for each endomorphism $f \in \textup{End}_{\mathcal{C}}(M)$
there exist $m,n \in \mathbb{N}$ such that $f^{(m+n)}=f^{m}$. If $m = 0$ and $n \geq 1$ then $f$ is bijective with $f^{-1} = f^{n-1}$.
\begin{proof}
The properties of a monoid are precisely the associativity of composition and the unit property from \ref{associativity_of_composition} and \ref{unit_property}.
Since $\abs{\textup{End}_{\mathcal{C}}(M)}<\infty$ there are only finitely many endomorphisms $f_{1},\dots, f_{N} \in \textup{End}_{\mathcal{C}}(M)$.
Let $\{f^{k} | k \in \mathbb{N} \} \subset \textup{End}_{\mathcal{C}}(M)$, i.e. there is a function 
$\{f^{k} | k \in \mathbb{N}\} \rightarrow \{f_{j} | j \in \{1,\dots,N\}\}; f^{k} \mapsto f_{j}$ not necessarily surjective and 
by the pigeonhole principle highly non injective, since $\abs{\mathbb{N}}>\abs{\textup{End}_{\mathcal{C}}(M)}$.
Let $m := Min \{ k \in \mathbb{N}| f^{k} =  f_{j} \}$

\begin{minipage}{.45\textwidth}\phantom{}\end{minipage}
\end{proof}
\end{lemma}

\begin{lemma}
Algorithm \ref{algo:RelationsOfEndomorphisms} terminates and yields the correct result.
\begin{proof}
Since $\mathcal{C}$ is a finite concrete category, for each object $M \in \mathcal{C}_{0}$ the endomorphism set
$\textup{End}_{\mathcal{C}}(M)$ is finite. If in step $i$, $f := gMor_{i} \in \textup{End}_{\mathcal{C}}(M)$ is an endomorphism,
then $\{f, f^{2}, f^{3}, \dots\}$ is a subset of the finite set $\textup{End}_{\mathcal{C}}(M)$, therefore $\exists N \in \mathbb{N}$ such that
$f^{k} \in \{f, f^{2}, f^{3}, \dots, f^{N}\} \, \forall k \geq N$.
This proves that the sets $mpowers$ and $npowers$, which contain increasing powers of $f$, will be finite and thus at some point
already contain $f^{m}$ or $f^{m+n}$ respectively, causing the while loops to terminate.
The if clause makes sure that the set $relsEndo$ only contains the desired relations. It remains to be shown that those are all
the endomorphism relations.
\end{proof}
\end{lemma}

\begin{algorithm}\capstart
    \caption{\texttt{RelationsOfEndomorphisms}}\label{algo:RelationsOfEndomorphisms}
	\SetKwInput{Input}{~Input}
	\SetKwInput{Output}{~Output}
	\Input{~a commutative ring $k$ and a finite concrete category $\mathcal{C}$}
	\Output{~the endomorphism relations of the category $\mathcal{C}$}
	\BlankLine
	let $q := \texttt{RightQuiverFromConcreteCategory}(\mathcal{C})$\;
	let $kq$ be the path algebra generated by $k$ and $q$\;
	let $gMor$ be the set of generating morphisms of $\mathcal{C}$\;
	let $A := Arrows(q)$\;
	set $relsEndo := \emptyset$\;
	\ForEach{$i = 1, \dots, Length(gMor)$}{
	    let $f := gMor_i$\\
	    \If{$f$ is not an endomorphism}{
		continue\;
	    }
	    let $m := 0$\;
	    set $mpowers := \emptyset$\;
	    let $foundEqual$ be false\;
	    \While{ $f^{m}\notin mpowers$ }{
		let $n := 1$\;
	        set $npowers := \emptyset$\;
		\While{ $\neg foundEqual$ and $f^{m+n} \notin npowers$ }{
		    \If{ $f^{m+n} = f^{m}$ }{
		    	Add the relation $kq.(A_{i})^{m+n}-kq.(A_{i})^{m}$ to relsEndo\;
		    	foundEqual := true\;
		    }
		    Add $f^{m+n}$ to npowers\;
		    n := n+1\;
		}
		Add $f^{m}$ to mpowers\;
		m := m+1\;
	    }
	}
	\Return{relsEndo}\;
\end{algorithm}